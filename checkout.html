<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - YTime Luxury</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>

@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap');

:root {
    --dark-blue: #0d1b2a;
    --navy-blue: #1b263b;
    --medium-blue: #2a3b52;
    --light-blue: #415a77;
    --gold: #d4af37;
    --gold-hover: #e6c158;
    --gold-light: rgba(212, 175, 55, 0.15);
    --white: #ffffff;
    --off-white: #f0f0f0;
    --gray-light: #e5e5e5;
    --gray: #6c757d;
    --black: #070b10;
    --body-font: 'Montserrat', sans-serif;
    --heading-font: 'Playfair Display', serif;
    --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.25);
    --shadow-md: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.25);
    --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.25);
    --shadow-gold: 0 0 15px rgba(212, 175, 55, 0.3);
    --transition: all 0.3s ease;
}

/* ----- Base Styles ----- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--body-font);
    background: linear-gradient(to bottom right, var(--dark-blue), var(--black));
    color: var(--off-white);
    line-height: 1.5;
    font-weight: 400;
    overflow-x: hidden;
    min-height: 100vh;
}

h1, h2, h3, h4, h5, h6 {
    font-family: var(--heading-font);
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--white);
    letter-spacing: 0.5px;
}

h1 {
    font-size: 2.5rem;
}

h2 {
    font-size: 2rem;
}

h3 {
    font-size: 1.5rem;
}

a {
    text-decoration: none;
    color: var(--white);
    transition: var(--transition);
}

a:hover {
    color: var(--gold);
}

ul {
    list-style: none;
}

img {
    max-width: 100%;
}

button, .auth-button {
    cursor: pointer;
    font-family: var(--body-font);
    font-weight: 500;
    transition: var(--transition);
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
}

.section-title {
    font-family: var(--heading-font);
    color: var(--white);
    margin-bottom: 1.5rem;
    position: relative;
    display: inline-block;
}

.section-title::after {
    content: '';
    position: absolute;
    width: 40%;
    height: 2px;
    background-color: var(--gold);
    bottom: -5px;
    left: 0;
}

/* ----- Custom Scrollbar ----- */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: var(--navy-blue);
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(var(--gold), var(--gold-hover));
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--gold-hover);
}

/* ----- Navigation ----- */
.navbar {
    position: sticky;
    top: 0;
    left: 0;
    width: 100%;
    background-color: rgba(13, 27, 42, 0.95);
    backdrop-filter: blur(10px);
    z-index: 1000;
    border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    box-shadow: var(--shadow-md);
}

.navbar-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
}

.logo {
    display: flex;
    align-items: center;
}

.logo img {
    height: 40px;
    margin-right: 0.75rem;
}

.logo-text {
    font-family: var(--heading-font);
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gold);
    letter-spacing: 1px;
}

.nav-links {
    display: flex;
    gap: 2rem;
}

.nav-link {
    position: relative;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
    padding: 0.5rem 0;
}

.nav-link::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    background-color: var(--gold);
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    transition: var(--transition);
}

.nav-link:hover::after {
    width: 100%;
}

.nav-icons-container {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.cart-icon {
    position: relative;
    color: var(--white);
    font-size: 1.2rem;
    cursor: pointer;
    transition: var(--transition);
}

.cart-icon:hover {
    color: var(--gold);
}

.cart-count {
    position: absolute;
    top: -8px;
    right: -10px;
    background-color: var(--gold);
    color: var(--navy-blue);
    font-size: 0.75rem;
    font-weight: 600;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.hamburger {
    display: none;
    flex-direction: column;
    justify-content: space-between;
    width: 30px;
    height: 20px;
    cursor: pointer;
}

.hamburger span {
    width: 100%;
    height: 2px;
    background-color: var(--white);
    transition: var(--transition);
}

.auth-button {
    background-color: transparent;
    border: 2px solid var(--gold);
    color: var(--gold);
    padding: 0.5rem 1.25rem;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 600;
    transition: var(--transition);
}

.auth-button:hover {
    background-color: var(--gold);
    color: var(--navy-blue);
    box-shadow: var(--shadow-gold);
}

/* ----- Checkout Section ----- */
.checkout-section {
    padding: 4rem 0;
}

.checkout-title {
    text-align: center;
    margin-bottom: 3rem;
    font-size: 2.5rem;
    color: var(--white);
    position: relative;
}

.checkout-title::after {
    content: '';
    position: absolute;
    width: 80px;
    height: 3px;
    background-color: var(--gold);
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
}

.checkout-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    background-color: var(--navy-blue);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
}

.checkout-left, .checkout-right {
    padding: 2rem;
}

.checkout-left {
    border-right: 1px solid rgba(212, 175, 55, 0.2);
}

.empty-cart {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 3rem 1rem;
}

.empty-cart i {
    font-size: 3rem;
    color: var(--gray);
    margin-bottom: 1rem;
}

.empty-cart h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.empty-cart p {
    color: var(--gray);
    margin-bottom: 1.5rem;
}

.continue-shopping {
    background-color: var(--gold);
    color: var(--navy-blue);
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    font-weight: 600;
    transition: var(--transition);
}

.continue-shopping:hover {
    background-color: var(--gold-hover);
    box-shadow: var(--shadow-gold);
}

/* ----- Cart Items ----- */
.cart-items {
    margin-bottom: 2rem;
}

.cart-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    margin-bottom: 1rem;
    background-color: var(--medium-blue);
    border-radius: 8px;
    transition: var(--transition);
}

.cart-item:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
}

.cart-item-image {
    width: 80px;
    height: 80px;
    overflow: hidden;
    border-radius: 8px;
    margin-right: 1rem;
    border: 1px solid rgba(212, 175, 55, 0.3);
}

.cart-item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.cart-item-info {
    flex: 1;
}

.cart-item-name {
    font-size: 1rem;
    margin-bottom: 0.5rem;
}

.cart-item-price {
    color: var(--gold);
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.cart-item-quantity {
    display: flex;
    align-items: center;
}

.quantity-btn {
    width: 28px;
    height: 28px;
    background-color: rgba(212, 175, 55, 0.2);
    border: 1px solid var(--gold);
    color: var(--gold);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: var(--transition);
}

.quantity-btn:hover {
    background-color: var(--gold);
    color: var(--navy-blue);
}

.quantity-value {
    margin: 0 0.75rem;
    min-width: 20px;
    text-align: center;
}

.cart-item-total {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    margin-left: 1rem;
}

.item-total {
    font-weight: 600;
    color: var(--white);
    margin-bottom: 0.5rem;
}

.remove-item {
    background-color: transparent;
    border: none;
    color: var(--gray);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition);
}

.remove-item:hover {
    color: var(--gold);
}

/* ----- Form Styles ----- */
.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    color: var(--gray-light);
}

.form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid var(--light-blue);
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    color: var(--white);
    font-family: var(--body-font);
    transition: var(--transition);
}

.form-input:focus {
    outline: none;
    border-color: var(--gold);
    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
}

.form-input::placeholder {
    color: var(--gray);
}

/* ----- Delivery Options ----- */
.delivery-options {
    margin-bottom: 2rem;
}

.delivery-option {
    display: flex;
    align-items: center;
    padding: 1rem;
    margin-bottom: 1rem;
    background-color: var(--medium-blue);
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
    border: 2px solid transparent;
}

.delivery-option:hover {
    background-color: rgba(27, 38, 59, 0.8);
}

.delivery-option.selected {
    border-color: var(--gold);
    background-color: var(--gold-light);
}

.delivery-radio {
    appearance: none;
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid var(--gold);
    border-radius: 50%;
    margin-right: 1rem;
    position: relative;
    cursor: pointer;
}

.delivery-radio:checked::after {
    content: '';
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: var(--gold);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.delivery-details {
    flex: 1;
}

.delivery-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.delivery-description {
    font-size: 0.85rem;
    color: var(--gray);
}

.delivery-price {
    font-weight: 600;
    color: var(--gold);
}

/* ----- Authentication Styles ----- */
.auth-frame-container {
    margin-bottom: 2rem;
}

.auth-alternatives {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.auth-button-social {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem;
    background-color: var(--medium-blue);
    border: 1px solid var(--light-blue);
    color: var(--white);
    border-radius: 8px;
    transition: var(--transition);
    font-size: 0.9rem;
}

.auth-button-social i {
    margin-right: 0.75rem;
    font-size: 1.2rem;
}

.auth-button-social:hover {
    background-color: var(--light-blue);
}

.agreement {
    margin-bottom: 2rem;
    color: var(--gray-light);
    font-size: 0.9rem;
}

.agreement a {
    color: var(--gold);
    font-weight: 500;
    text-decoration: underline;
}

.agreement input[type="checkbox"] {
    margin-right: 0.5rem;
    accent-color: var(--gold);
}

/* ----- Order Summary ----- */
.order-summary {
    background-color: var(--medium-blue);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(212, 175, 55, 0.1);
}

.summary-total {
    display: flex;
    justify-content: space-between;
    padding: 1rem 0;
    margin-top: 0.5rem;
    border-top: 2px solid rgba(212, 175, 55, 0.2);
    font-size: 1.1rem;
    font-weight: 700;
}

/* ----- Payment Methods ----- */
.payment-methods {
    margin-bottom: 2rem;
}

.payment-method {
    display: flex;
    align-items: center;
    padding: 1rem;
    margin-bottom: 1rem;
    background-color: var(--medium-blue);
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
    border: 2px solid transparent;
}

.payment-method:hover {
    background-color: rgba(27, 38, 59, 0.8);
}

.payment-method.selected {
    border-color: var(--gold);
    background-color: var(--gold-light);
}

.payment-radio {
    appearance: none;
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid var(--gold);
    border-radius: 50%;
    margin-right: 1rem;
    position: relative;
    cursor: pointer;
}

.payment-radio:checked::after {
    content: '';
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: var(--gold);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.payment-details {
    flex: 1;
}

.payment-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
    display: flex;
    align-items: center;
}

.payment-title i {
    margin-right: 0.5rem;
    color: var(--gold);
}

.payment-description {
    font-size: 0.85rem;
    color: var(--gray);
}

.checkout-button {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(to right, var(--gold), var(--gold-hover));
    color: var(--navy-blue);
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    transition: var(--transition);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.checkout-button:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: var(--shadow-gold);
}

.checkout-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* ----- Footer ----- */
.footer {
    background-color: var(--black);
    padding: 4rem 0 1rem;
    margin-top: 4rem;
    border-top: 1px solid rgba(212, 175, 55, 0.2);
}

.footer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.footer-logo {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
}

.footer-logo img {
    height: 40px;
    margin-right: 0.75rem;
}

.footer-about {
    color: var(--gray);
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.footer-social {
    display: flex;
    gap: 1rem;
}

.social-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 36px;
    height: 36px;
    background-color: var(--medium-blue);
    border-radius: 50%;
    color: var(--white);
    transition: var(--transition);
}

.social-icon:hover {
    background-color: var(--gold);
    color: var(--navy-blue);
    transform: translateY(-3px);
}

.footer-heading {
    font-size: 1.25rem;
    margin-bottom: 1.25rem;
    position: relative;
    display: inline-block;
}

.footer-heading::after {
    content: '';
    position: absolute;
    width: 40%;
    height: 2px;
    background-color: var(--gold);
    bottom: -5px;
    left: 0;
}

.footer-links {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.footer-links a {
    color: var(--gray);
    transition: var(--transition);
}

.footer-links a:hover {
    color: var(--gold);
    transform: translateX(5px);
}

.footer-contact-item {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    color: var(--gray);
}

.footer-contact-item i {
    width: 25px;
    color: var(--gold);
    margin-right: 0.75rem;
}

.footer-bottom {
    text-align: center;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(212, 175, 55, 0.1);
    color: var(--gray);
    font-size: 0.9rem;
}

/* ----- Notifications ----- */
.add-to-cart-notification, .remove-from-cart-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: var(--navy-blue);
    color: var(--white);
    padding: 1rem 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--gold);
    box-shadow: var(--shadow-md);
    z-index: 1100;
    transform: translateY(0);
    opacity: 1;
    transition: var(--transition);
}

.add-to-cart-notification.fadeOut, .remove-from-cart-notification.fadeOut {
    transform: translateY(20px);
    opacity: 0;
}

/* ----- Responsive Styles ----- */
@media (max-width: 992px) {
    .navbar-container {
        padding: 0.75rem 0;
    }
    
    .checkout-container {
        grid-template-columns: 1fr;
    }
    
    .checkout-left {
        border-right: none;
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    }
}

@media (max-width: 768px) {
    .hamburger {
        display: flex;
    }
    
    .nav-links {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background-color: var(--navy-blue);
        flex-direction: column;
        align-items: center;
        padding: 1rem 0;
        gap: 1rem;
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: var(--transition);
        z-index: 900;
    }
    
    .nav-links.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
    }
    
    .nav-icons-container {
        gap: 1rem;
    }
    
    .cart-item {
        flex-wrap: wrap;
    }
    
    .cart-item-total {
        width: 100%;
        flex-direction: row;
        justify-content: space-between;
        margin-top: 1rem;
        margin-left: 0;
        padding-top: 0.5rem;
        border-top: 1px solid rgba(212, 175, 55, 0.1);
    }
}

@media (max-width: 576px) {
    h1 {
        font-size: 2rem;
    }
    
    h2 {
        font-size: 1.75rem;
    }
    
    .logo img {
        height: 30px;
    }
    
    .logo-text {
        font-size: 1.5rem;
    }
    
    .checkout-left, .checkout-right {
        padding: 1.5rem;
    }
    
    .footer-grid {
        grid-template-columns: 1fr;
    }
}
        
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <div class="logo">
                <img src="ytime_luxury-removebg-preview.png" alt="YTime Logo">
                <span class="logo-text">YTime</span>
            </div>

            <div class="hamburger">
                <span></span>
                <span></span>
            </div>

            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="shop.html" class="nav-link">Collection</a></li>
                <li><a href="service.html" class="nav-link">Services</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
            </ul>

            <div class="nav-icons-container">
                <div class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </div>
                <div class="nav-auth-container">
                    <button id="authButton" class="auth-button">Sign In</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Checkout Section -->
    <section class="checkout-section">
        <div class="container">
            <h1 class="checkout-title">Checkout</h1>
            
            <div id="emptyCartMessage" class="empty-cart" style="display: none;">
                <i class="fas fa-shopping-cart"></i>
                <h3>Your cart is empty</h3>
                <p>Looks like you haven't added any watches to your cart yet.</p>
                <a href="shop.html" class="continue-shopping">Continue Shopping</a>
            </div>

            <div id="checkoutContainer" class="checkout-container">
                <div class="checkout-left">
                    <div class="cart-items">
                        <h2 class="section-title">Your Cart</h2>
                        <div id="cartItemsContainer">
                            <!-- Cart items will be populated here -->
                        </div>
                    </div>

                    <div class="customer-info">
                        <h2 class="section-title">Personal Information</h2>
                        <div class="form-group">
                            <label for="fullName" class="form-label">Full Name</label>
                            <input type="text" id="fullName" class="form-input" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" id="email" class="form-input" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone" class="form-label">Mobile Number</label>
                            <input type="tel" id="phone" class="form-input" placeholder="Enter your mobile number" required>
                        </div>
                    </div>

                    <div class="delivery-options">
                        <h2 class="section-title">Delivery Options</h2>
                        <div class="delivery-option selected" data-fee="0" data-location="nairobi">
                            <input type="radio" name="delivery" id="nairobi" class="delivery-radio" checked>
                            <div class="delivery-details">
                                <div class="delivery-title">Nairobi County</div>
                                <div class="delivery-description">Free delivery within Nairobi</div>
                            </div>
                            <div class="delivery-price">Free</div>
                        </div>
                        <div class="delivery-option" data-fee="300" data-location="kenya">
                            <input type="radio" name="delivery" id="kenya" class="delivery-radio">
                            <div class="delivery-details">
                                <div class="delivery-title">Other Counties in Kenya</div>
                                <div class="delivery-description">Delivery to any other county in Kenya</div>
                            </div>
                            <div class="delivery-price">KES 300</div>
                        </div>
                        <div class="delivery-option" data-fee="1000" data-location="eastafrica">
                            <input type="radio" name="delivery" id="eastafrica" class="delivery-radio">
                            <div class="delivery-details">
                                <div class="delivery-title">East Africa Countries</div>
                                <div class="delivery-description">Delivery to Tanzania, Uganda, Rwanda, Burundi</div>
                            </div>
                            <div class="delivery-price">KES 1,000</div>
                        </div>
                    </div>

                    <div class="auth-frame-container">
                        <h2 class="section-title">Login Information</h2>
                        <div class="auth-alternatives">
                            <button class="auth-button-social">
                                <i class="fab fa-google"></i> Login with Google
                            </button>
                            <button class="auth-button-social">
                                <i class="fab fa-apple"></i> Login with Apple
                            </button>
                        </div>
                        <!-- Uncomment this to use iframe for login
                        <iframe src="login.html" class="auth-frame" title="Login Frame"></iframe>
                        -->
                    </div>

                    <div class="agreement">
                        <label>
                            <input type="checkbox" id="termsAgreement">
                            I agree to the <a href="#">Terms & Conditions</a> and <a href="#">Privacy Policy</a>
                        </label>
                    </div>
                </div>

                <div class="checkout-right">
                    <div class="order-summary">
                        <h2 class="section-title">Order Summary</h2>
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="subtotal">KES 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping</span>
                            <span id="shipping">KES 0</span>
                        </div>
                        <div class="summary-total">
                            <span>Total</span>
                            <span id="orderTotal">KES 0</span>
                        </div>
                    </div>

                    <div class="payment-methods">
                        <h2 class="section-title">Payment Method</h2>
                        <div class="payment-method selected" data-method="mpesa">
                            <input type="radio" name="payment" id="mpesa" class="payment-radio" checked>
                            <div class="payment-details">
                                <div class="payment-title"><i class="fas fa-mobile-alt"></i> M-Pesa STK Push</div>
                                <div class="payment-description">Pay using M-Pesa STK Push (Coming Soon)</div>
                            </div>
                        </div>
                        <div class="payment-method" data-method="whatsapp">
                            <input type="radio" name="payment" id="whatsapp" class="payment-radio">
                            <div class="payment-details">
                                <div class="payment-title"><i class="fab fa-whatsapp"></i> WhatsApp</div>
                                <div class="payment-description">Continue on WhatsApp to complete your purchase</div>
                            </div>
                        </div>
                    </div>

                    <button id="checkoutButton" class="checkout-button" disabled>Complete Purchase</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer" id="contact">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <div class="footer-logo">
                        <img src="ytime_luxury-removebg-preview.png" alt="YTime Logo">
                        <span class="logo-text">YTime</span>
                    </div>
                    <p class="footer-about">
                        YTime is a premier destination for luxury timepieces, offering a curated selection of the world's finest watches and exceptional customer service.
                    </p>
                    <div class="footer-social">
                        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>

                <div>
                    <h3 class="footer-heading">Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#home">Home</a></li>
                        <li><a href="#collection">Collection</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="footer-heading">Help & Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">FAQs</a></li>
                        <li><a href="#">Shipping Info</a></li>
                        <li><a href="#">Returns Policy</a></li>
                        <li><a href="#">Warranty</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="footer-heading">Contact Us</h3>
                    <div class="footer-contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Nairobi Kenya</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-phone"></i>
                        <span>+254117278821</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>info@ytime.co.ke</span>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 YTime Luxury. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Database configuration
    const DB_VERSION = 1;
    const CART_STORE_NAME = 'cart';
    const PRODUCT_STORE_NAME = 'products';
    let allDatabases = [];
    
    // Initialize and open the cart display
    async function initCartDisplay() {
        try {
            // Find and initialize all relevant IndexedDB databases
            await findAllDatabases();
            
            // Display cart items
            await displayCartContents();
            
            // Setup event listeners for real-time updates
            setupCartEventListeners();
            
            // Fetch and display products from all databases
            await fetchAndDisplayAllProducts();
            
            console.log('Cart display and products initialized successfully');
        } catch (error) {
            console.error('Failed to initialize cart display:', error);
            fallbackToLocalStorage();
        }
    }
    
    // Find all databases in IndexedDB
    async function findAllDatabases() {
        try {
            // Get all database names using indexedDB.databases() if available
            if (indexedDB.databases) {
                const databases = await indexedDB.databases();
                console.log('Found IndexedDB databases:', databases);
                
                // Connect to each database
                for (const dbInfo of databases) {
                    try {
                        const db = await connectToDatabase(dbInfo.name, DB_VERSION);
                        if (db) {
                            allDatabases.push({
                                name: dbInfo.name,
                                instance: db
                            });
                        }
                    } catch (err) {
                        console.warn(`Failed to connect to database ${dbInfo.name}:`, err);
                    }
                }
            } else {
                // Fallback for browsers that don't support indexedDB.databases()
                // Try to connect to known database names
                const knownDBNames = ['ytimeShopDB', 'YtimeShopDB'];
                for (const dbName of knownDBNames) {
                    try {
                        const db = await connectToDatabase(dbName, DB_VERSION);
                        if (db) {
                            allDatabases.push({
                                name: dbName,
                                instance: db
                            });
                        }
                    } catch (err) {
                        console.warn(`Failed to connect to database ${dbName}:`, err);
                    }
                }
            }
            
            console.log(`Connected to ${allDatabases.length} databases`);
            return allDatabases.length > 0;
        } catch (error) {
            console.error('Error finding databases:', error);
            throw error;
        }
    }
    
    // Connect to a specific database
    function connectToDatabase(dbName, dbVersion) {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(dbName, dbVersion);
            
            request.onerror = (event) => {
                console.error(`IndexedDB error for ${dbName}:`, event.target.error);
                // Don't reject here, as one database might not exist
                resolve(null);
            };
            
            request.onsuccess = (event) => {
                const database = event.target.result;
                console.log(`IndexedDB ${dbName} connected successfully`);
                resolve(database);
            };
            
            request.onupgradeneeded = (event) => {
                const database = event.target.result;
                if (!database.objectStoreNames.contains(CART_STORE_NAME)) {
                    database.createObjectStore(CART_STORE_NAME, { keyPath: 'id' });
                    console.log(`Cart object store created in ${dbName}`);
                }
                if (!database.objectStoreNames.contains(PRODUCT_STORE_NAME)) {
                    database.createObjectStore(PRODUCT_STORE_NAME, { keyPath: 'id' });
                    console.log(`Products object store created in ${dbName}`);
                }
            };
        });
    }
    
    // Get cart items from all connected databases
    async function getAllCartItems() {
        const cartItemsMap = new Map(); // Use a map to avoid duplicates
        
        if (allDatabases.length === 0) {
            console.warn("No IndexedDB databases available");
            return [];
        }
        
        // Get cart items from each database
        for (const db of allDatabases) {
            try {
                if (!db.instance || !db.instance.objectStoreNames.contains(CART_STORE_NAME)) {
                    continue;
                }
                
                const items = await getCartItemsFromDB(db.instance, db.name);
                // Add items to map to avoid duplicates (based on item id)
                items.forEach(item => {
                    // If item already exists, take the one with the higher quantity
                    if (cartItemsMap.has(item.id)) {
                        const existingItem = cartItemsMap.get(item.id);
                        if (item.quantity > existingItem.quantity) {
                            cartItemsMap.set(item.id, item);
                        }
                    } else {
                        cartItemsMap.set(item.id, item);
                    }
                });
            } catch (error) {
                console.error(`Error getting cart items from ${db.name}:`, error);
            }
        }
        
        // Convert map values to array
        return Array.from(cartItemsMap.values());
    }
    
    // Fetch cart items from a specific database
    function getCartItemsFromDB(database, dbName) {
        return new Promise((resolve, reject) => {
            if (!database) {
                reject(`Database ${dbName} not initialized`);
                return;
            }
            
            try {
                const transaction = database.transaction(CART_STORE_NAME, 'readonly');
                const store = transaction.objectStore(CART_STORE_NAME);
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const items = request.result;
                    console.log(`Retrieved ${items.length} cart items from ${dbName}:`, items);
                    resolve(items);
                };
                
                request.onerror = (event) => {
                    console.error(`Error loading cart from ${dbName}:`, event.target.error);
                    reject(event.target.error);
                };
            } catch (error) {
                console.error(`Error accessing cart in ${dbName}:`, error);
                reject(error);
            }
        });
    }
    
    // Fetch products from a specific database
    function getProductsFromDB(database, dbName) {
        return new Promise((resolve, reject) => {
            if (!database || !database.objectStoreNames.contains(PRODUCT_STORE_NAME)) {
                console.log(`Product store not found in ${dbName}`);
                resolve([]);
                return;
            }
            
            try {
                const transaction = database.transaction(PRODUCT_STORE_NAME, 'readonly');
                const store = transaction.objectStore(PRODUCT_STORE_NAME);
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const products = request.result;
                    console.log(`Retrieved ${products.length} products from ${dbName}:`, products);
                    resolve(products);
                };
                
                request.onerror = (event) => {
                    console.error(`Error loading products from ${dbName}:`, event.target.error);
                    resolve([]); // Resolve with empty array instead of rejecting
                };
            } catch (error) {
                console.error(`Error accessing products in ${dbName}:`, error);
                resolve([]); // Resolve with empty array instead of rejecting
            }
        });
    }
    
    // Fetch products from all databases and merge them
    async function fetchAndDisplayAllProducts() {
        try {
            const productMap = new Map();
            let totalProductsFound = 0;
            
            // Get products from all databases
            for (const db of allDatabases) {
                try {
                    const products = await getProductsFromDB(db.instance, db.name);
                    totalProductsFound += products.length;
                    
                    // Add products to map (avoiding duplicates by ID)
                    products.forEach(product => {
                        // Skip products without an ID
                        if (!product.id) return;
                        
                        // Fix for price handling
                        // First, check if we already have this product with a valid price
                        const existingProduct = productMap.get(product.id);
                        if (existingProduct && isValidPrice(existingProduct.price) && !isValidPrice(product.price)) {
                            // Keep the existing product with valid price
                            return;
                        }
                        
                        // Ensure price is a valid number
                        product.price = parseValidPrice(product.price);
                        
                        // Add or update the product in our map
                        productMap.set(product.id, product);
                    });
                } catch (error) {
                    console.error(`Error fetching products from ${db.name}:`, error);
                }
            }
            
            // Convert map back to array and sort by name
            const allProducts = Array.from(productMap.values())
                .filter(product => product.name) // Only include products with names
                .sort((a, b) => a.name.localeCompare(b.name));
            
            console.log(`Combined ${totalProductsFound} products into ${allProducts.length} unique products`);
            
            // Render the combined product list
            renderProducts(allProducts);
        } catch (error) {
            console.error('Error fetching products:', error);
            displayNoProducts();
        }
    }
    
    // Helper function to check if a price is valid
    function isValidPrice(price) {
        if (price === undefined || price === null) return false;
        
        // Convert to number if it's a string
        const numPrice = typeof price === 'string' ? parseFloat(price) : price;
        
        // Check if it's a valid number and greater than or equal to 0
        return typeof numPrice === 'number' && !isNaN(numPrice) && numPrice >= 0;
    }
    
    // Helper function to parse and validate a price value
    function parseValidPrice(price) {
        // If it's a valid number, return it directly
        if (typeof price === 'number' && !isNaN(price)) {
            return price;
        }
        
        // If it's a string that can be converted to a number
        if (typeof price === 'string') {
            // Remove any non-numeric characters except decimal point
            const cleanPrice = price.replace(/[^0-9.]/g, '');
            const numPrice = parseFloat(cleanPrice);
            
            if (!isNaN(numPrice)) {
                return numPrice;
            }
        }
        
        // Default to 0 if price is invalid
        return 0;
    }
    
    // Display a message when no products are available
    function displayNoProducts() {
        const productsContainer = document.getElementById('productsContainer');
        if (productsContainer) {
            productsContainer.innerHTML = '<div class="no-products">No products available</div>';
        }
    }
    
    // Render products in the DOM
    function renderProducts(products) {
        const productsContainer = document.getElementById('productsContainer');
        if (!productsContainer) {
            console.error('Products container not found');
            return;
        }
        
        if (!products || products.length === 0) {
            displayNoProducts();
            return;
        }
        
        let productsHTML = '';
        
        products.forEach(product => {
            // Ensure price is a number and format it
            const price = isValidPrice(product.price) ? product.price : 0;
            
            productsHTML += `
                <div class="product-card" data-id="${product.id}">
                    <div class="product-image">
                        <img src="${product.image || '/api/placeholder/200/200'}" alt="${product.name}" onerror="this.src='/api/placeholder/200/200'">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">KES ${price.toLocaleString()}</div>
                        <button class="add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                    </div>
                </div>
            `;
        });
        
        productsContainer.innerHTML = productsHTML;
        
        // Add event listeners to the newly created Add to Cart buttons
        const addToCartButtons = productsContainer.querySelectorAll('.add-to-cart-btn');
        addToCartButtons.forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                addToCart(productId);
            });
        });
    }
    
    // Fallback to localStorage if IndexedDB fails
    function fallbackToLocalStorage() {
        console.log('Falling back to localStorage for cart data');
        try {
            const cartItemsString = localStorage.getItem('cartItems');
            if (!cartItemsString) {
                displayEmptyCart();
                return;
            }
            
            const cartItems = JSON.parse(cartItemsString);
            if (!Array.isArray(cartItems) || cartItems.length === 0) {
                displayEmptyCart();
                return;
            }
            
            renderCartItems(cartItems);
            
        } catch (error) {
            console.error('Error retrieving cart data from localStorage:', error);
            displayEmptyCart();
        }
    }
    
    // Display empty cart message
    function displayEmptyCart() {
        const cartContainer = document.getElementById('cartItemsContainer');
        if (cartContainer) {
            cartContainer.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
        }
        
        const subtotalElement = document.getElementById('subtotal');
        const orderTotalElement = document.getElementById('orderTotal');
        
        if (subtotalElement) subtotalElement.textContent = 'KES 0';
        if (orderTotalElement) orderTotalElement.textContent = 'KES 0';
        
        // Hide checkout button if it exists
        const checkoutButton = document.querySelector('.checkout-button');
        if (checkoutButton) {
            checkoutButton.style.display = 'none';
        }
    }
    
    // Render cart items in the DOM
    function renderCartItems(items) {
        const cartContainer = document.getElementById('cartItemsContainer');
        if (!cartContainer) {
            console.error('Cart container not found');
            return;
        }
        
        if (items.length === 0) {
            displayEmptyCart();
            return;
        }
        
        let cartHTML = '';
        let subtotal = 0;
        
        items.forEach((item, index) => {
            // Ensure price is a number
            const price = isValidPrice(item.price) ? item.price : 0;
            const quantity = typeof item.quantity === 'number' ? item.quantity : 0;
            const itemTotal = price * quantity;
            subtotal += itemTotal;
            
            cartHTML += `
                <div class="cart-item" data-id="${item.id}">
                    <div class="cart-item-image">
                        <img src="${item.image || '/api/placeholder/80/80'}" alt="${item.name}" onerror="this.src='/api/placeholder/80/80'">
                    </div>
                    <div class="cart-item-info">
                        <h3 class="cart-item-name">${item.name}</h3>
                        <div class="cart-item-price">KES ${price.toLocaleString()}</div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn decrease" data-index="${index}">-</button>
                            <span class="quantity-value">${quantity}</span>
                            <button class="quantity-btn increase" data-index="${index}">+</button>
                        </div>
                    </div>
                    <div class="cart-item-total">
                        <div class="item-total">KES ${itemTotal.toLocaleString()}</div>
                        <button class="remove-item" data-index="${index}">Ã—</button>
                    </div>
                </div>
            `;
        });
        
        cartContainer.innerHTML = cartHTML;
        updateCartSummary(subtotal);
        
        // Show checkout button if it exists
        const checkoutButton = document.querySelector('.checkout-button');
        if (checkoutButton) {
            checkoutButton.style.display = 'block';
        }
    }
    
    // Update cart summary values
    function updateCartSummary(subtotal) {
        const subtotalElement = document.getElementById('subtotal');
        const shippingElement = document.getElementById('shipping');
        const orderTotalElement = document.getElementById('orderTotal');
        
        if (subtotalElement) {
            subtotalElement.textContent = `KES ${subtotal.toLocaleString()}`;
        }
        
        // Calculate shipping based on selected option
        let shippingCost = 0;
        const selectedShipping = document.querySelector('.delivery-option.selected');
        if (selectedShipping) {
            const shippingValue = selectedShipping.getAttribute('data-fee');
            shippingCost = shippingValue ? parseInt(shippingValue) : 0;
        }
        
        if (shippingElement) {
            shippingElement.textContent = shippingCost === 0 ? 'Free' : `KES ${shippingCost.toLocaleString()}`;
        }
        
        if (orderTotalElement) {
            orderTotalElement.textContent = `KES ${(subtotal + shippingCost).toLocaleString()}`;
        }
        
        // Update item count badge if it exists
        const cartCountBadge = document.querySelector('.cart-count');
        if (cartCountBadge) {
            getCartItemCount().then(count => {
                cartCountBadge.textContent = count.toString();
                
                // Make the badge visible only if there are items
                if (count > 0) {
                    cartCountBadge.style.display = 'block';
                } else {
                    cartCountBadge.style.display = 'none';
                }
            });
        }
    }
    
    // Get total number of items in cart
    async function getCartItemCount() {
        try {
            const items = await getCartItemsWithFallback();
            return items.reduce((total, item) => total + item.quantity, 0);
        } catch (error) {
            console.error('Error getting cart item count:', error);
            return 0;
        }
    }
    
    // Get cart items with localStorage fallback
    async function getCartItemsWithFallback() {
        try {
            if (allDatabases.length > 0) {
                return await getAllCartItems();
            } else {
                throw new Error('No IndexedDB databases available');
            }
        } catch (error) {
            console.log('Falling back to localStorage for cart data:', error);
            try {
                const cartItemsString = localStorage.getItem('cartItems');
                if (!cartItemsString) return [];
                
                const cartItems = JSON.parse(cartItemsString);
                return Array.isArray(cartItems) ? cartItems : [];
            } catch (localStorageError) {
                console.error('Error retrieving from localStorage:', localStorageError);
                return [];
            }
        }
    }
    
    // Setup event listeners for cart interactions
    function setupCartEventListeners() {
        document.addEventListener('click', async function(event) {
            // Handle quantity decrease
            if (event.target.classList.contains('decrease')) {
                const index = parseInt(event.target.getAttribute('data-index'));
                await updateQuantity(index, -1);
            }
            
            // Handle quantity increase
            if (event.target.classList.contains('increase')) {
                const index = parseInt(event.target.getAttribute('data-index'));
                await updateQuantity(index, 1);
            }
            
            // Handle item removal
            if (event.target.classList.contains('remove-item')) {
                const index = parseInt(event.target.getAttribute('data-index'));
                await removeItem(index);
            }
            
            // Handle adding product to cart
            if (event.target.classList.contains('add-to-cart-btn')) {
                const productId = event.target.getAttribute('data-id');
                await addToCart(productId);
            }
        });
        
        // Handle shipping selection changes
        const deliveryOptions = document.querySelectorAll('.delivery-option');
        deliveryOptions.forEach(option => {
            option.addEventListener('click', async function() {
                deliveryOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                
                const items = await getCartItemsWithFallback();
                const subtotal = calculateSubtotal(items);
                updateCartSummary(subtotal);
            });
        });
        
        // Handle checkout button click
        const checkoutButton = document.querySelector('.checkout-button');
        if (checkoutButton) {
            checkoutButton.addEventListener('click', async function() {
                const items = await getCartItemsWithFallback();
                if (items.length === 0) {
                    alert('Your cart is empty');
                    return;
                }
                
                // Redirect to checkout page or perform checkout action
                alert('Proceeding to checkout...');
                // window.location.href = '/checkout.html';
            });
        }
    }
    
    // Add product to cart
    async function addToCart(productId) {
        try {
            // Find product in any database
            let product = null;
            
            for (const db of allDatabases) {
                if (!db.instance || !db.instance.objectStoreNames.contains(PRODUCT_STORE_NAME)) {
                    continue;
                }
                
                try {
                    const transaction = db.instance.transaction(PRODUCT_STORE_NAME, 'readonly');
                    const store = transaction.objectStore(PRODUCT_STORE_NAME);
                    const request = store.get(productId);
                    
                    await new Promise((resolve) => {
                        request.onsuccess = () => {
                            if (request.result) {
                                product = request.result;
                            }
                            resolve();
                        };
                        request.onerror = () => resolve();
                    });
                    
                    if (product) break; // Exit loop if product found
                    
                } catch (error) {
                    console.log(`Error checking database ${db.name} for product:`, error);
                }
            }
            
            if (!product) {
                console.error('Product not found in any database');
                return;
            }
            
            // Get current cart
            const cartItems = await getCartItemsWithFallback();
            
            // Check if product already in cart
            const existingItemIndex = cartItems.findIndex(item => item.id === product.id);
            
            // Make sure price is valid
            const validPrice = parseValidPrice(product.price);
            
            if (existingItemIndex >= 0) {
                // Increment quantity if product already in cart
                cartItems[existingItemIndex].quantity += 1;
                // Update price if current price is invalid
                if (!isValidPrice(cartItems[existingItemIndex].price)) {
                    cartItems[existingItemIndex].price = validPrice;
                }
            } else {
                // Add new item to cart
                cartItems.push({
                    id: product.id,
                    name: product.name,
                    price: validPrice,
                    image: product.image,
                    quantity: 1
                });
            }
            
            // Save updated cart
            await saveCartItems(cartItems);
            
            // Update display
            await displayCartContents();
            
            // Show confirmation
            const notification = document.createElement('div');
            notification.className = 'add-to-cart-notification';
            notification.textContent = `Added ${product.name} to cart`;
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.add('fadeOut');
                setTimeout(() => {
                    notification.remove();
                }, 500);
            }, 2500);
            
        } catch (error) {
            console.error('Error adding product to cart:', error);
        }
    }
    
    // Update item quantity
    async function updateQuantity(index, change) {
        try {
            const items = await getCartItemsWithFallback();
            if (!items[index]) return;
            
            items[index].quantity += change;
            
            if (items[index].quantity < 1) {
                // Remove item if quantity is less than 1
                items.splice(index, 1);
            }
            
            await saveCartItems(items);
            await displayCartContents();
        } catch (error) {
            console.error('Error updating quantity:', error);
        }
    }
    
    // Remove item from cart
    async function removeItem(index) {
        try {
            const items = await getCartItemsWithFallback();
            if (!items[index]) return;
            
            const itemName = items[index].name;
            items.splice(index, 1);
            await saveCartItems(items);
            await displayCartContents();
            
            // Show removal confirmation
            const notification = document.createElement('div');
            notification.className = 'remove-from-cart-notification';
            notification.textContent = `Removed ${itemName} from cart`;
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.add('fadeOut');
                setTimeout(() => {
                    notification.remove();
                }, 500);
            }, 2500);
        } catch (error) {
            console.error('Error removing item:', error);
        }
    }
    
    // Save cart items to all connected databases and localStorage
    async function saveCartItems(items) {
        // Save to localStorage as fallback
        localStorage.setItem('cartItems', JSON.stringify(items));
        
        // Save to all available IndexedDB databases
        if (allDatabases.length === 0) return;
        
        const savePromises = [];
        
        for (const db of allDatabases) {
            if (!db.instance || !db.instance.objectStoreNames.contains(CART_STORE_NAME)) {
                continue;
            }
            
            try {
                const savePromise = new Promise((resolve, reject) => {
                    try {
                        const transaction = db.instance.transaction(CART_STORE_NAME, 'readwrite');
                        const store = transaction.objectStore(CART_STORE_NAME);
                        
                        // Clear existing items
                        clearObjectStore(store).then(() => {
                            // Add new items
                            for (const item of items) {
                                store.add(item);
                            }
                            
                            transaction.oncomplete = () => {
                                console.log(`Cart saved to ${db.name} successfully`);
                                resolve();
                            };
                            
                            transaction.onerror = (event) => {
                                console.error(`Error saving cart to ${db.name}:`, event.target.error);
                                reject(event.target.error);
                            };
                        });
                    } catch (error) {
                        console.error(`Error accessing ${db.name} for saving:`, error);
                        reject(error);
                    }
                });
                
                savePromises.push(savePromise);
            } catch (error) {
                console.error(`Error preparing transaction for ${db.name}:`, error);
            }
        }
        
        // Wait for all save operations to complete
        if (savePromises.length > 0) {
            try {
                await Promise.allSettled(savePromises);
                console.log('Cart saved to all available databases');
            } catch (error) {
                console.error('Error in one or more database saves:', error);
            }
        }
    }
    
    // Clear all items from object store
    function clearObjectStore(store) {
        return new Promise((resolve, reject) => {
            const request = store.clear();
            request.onsuccess = () => resolve();
            request.onerror = (event) => reject(event.target.error);
        });
    }
    
    // Calculate subtotal from items
    function calculateSubtotal(items) {
        return items.reduce((total, item) => {
            const price = isValidPrice(item.price) ? item.price : 0;
            const quantity = typeof item.quantity === 'number' ? item.quantity : 0;
            return total + (price * quantity);
        }, 0);
    }
    
    // Display cart contents
    async function displayCartContents() {
        try {
            const items = await getCartItemsWithFallback();
            renderCartItems(items);
        } catch (error) {
            console.error('Error displaying cart contents:', error);
            fallbackToLocalStorage();
        }
    }
    
    // Initialize the cart display
    initCartDisplay();
});
    </script>
</body>
</html>
